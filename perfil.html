<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmotiQuest - Mi Perfil</title>
  
  <!-- Fuentes Google -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  
    <!-- Estilos -->
  
    
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="stylesheet" href="./css/perfil.css">
</head>
<body>

  <!-- Header -->
  <header class="perfil-header">
    <div class="container">
      <div class="app-logo">
        <img src="./images/logo/emotiquest-logo.png" alt="EmotiQuest Logo" class="logo-image">
      </div>
        <h1 class="perfil-title">EmotiQuest</h1>
        <p class="app-subtitle"> Lo que callas tambiÃ©n pesa </p>
    </div>
    <div class="perfil-header-actions">
      <button class="btn-volver" onclick="volverAtras()">
        â† Volver
      </button>
    </div>
  </header>

  <!-- Contenedor Principal -->
  <main class="perfil-container">
    <div class="perfil-card">
      
      <!-- Avatar y Nombre -->
      <div class="perfil-avatar-section">
        <div class="perfil-avatar" id="perfilAvatar">
          <span class="perfil-avatar-emoji" id="avatarEmoji">ğŸ˜Š</span>
        </div>
        <h2 class="perfil-nombre" id="perfilNombre">Nombre del Estudiante</h2>
        <span class="perfil-badge" id="perfilBadge">
          <span>ğŸ“</span>
          <span id="badgeTexto">Estudiante</span>
        </span>
      </div>

      <!-- Datos Personales -->
      <div class="perfil-datos">
        <div class="dato-item">
          <div class="dato-icon">ğŸ‚</div>
          <div class="dato-label">Edad</div>
          <div class="dato-value" id="perfilEdad">--</div>
        </div>

        <div class="dato-item">
          <div class="dato-icon">âš§ï¸</div>
          <div class="dato-label">GÃ©nero</div>
          <div class="dato-value" id="perfilGenero">--</div>
        </div>

        <div class="dato-item">
          <div class="dato-icon">ğŸ“š</div>
          <div class="dato-label">Grado</div>
          <div class="dato-value" id="perfilGrado">--</div>
        </div>
      </div>

      <!-- EstadÃ­sticas Emocionales -->
      <div class="perfil-stats">
        <h3 class="stats-title">
          <span>ğŸ“Š</span>
          <span>Mis EstadÃ­sticas Emocionales</span>
        </h3>
        <div class="stats-grid">
          <div class="stat-box">
            <div class="stat-numero" id="statSesiones">0</div>
            <div class="stat-texto">Sesiones Completadas</div>
          </div>
          <div class="stat-box">
            <div class="stat-numero" id="statRespuestas">0</div>
            <div class="stat-texto">Preguntas Respondidas</div>
          </div>
          <div class="stat-box">
            <div class="stat-numero" id="statEmocion">ğŸ˜Š</div>
            <div class="stat-texto">EmociÃ³n Frecuente</div>
          </div>
        </div>
      </div>

      <!-- ID Ãšnico -->
      <div class="perfil-id-section">
        <div class="perfil-id-label">ğŸ†” ID Ãšnico de Usuario</div>
        <div class="perfil-id-value" id="perfilId">EMQ-XXXXXXXX-XXXX</div>
      </div>

    </div>
  </main>

  <!-- Footer -->
  <footer class="perfil-footer">
    <p>Â© 2025 EmotiQuest - Tu perfil emocional</p>
  </footer>

  <!-- JavaScript -->
  <script>
    // ==================== CONFIGURACIÃ“N ====================
    // Definir emociones con sus emojis (sincronizado con emociones.js)
    const EMOCIONES_CONFIG = {
      alegria: { emoji: 'ğŸ˜Š', color: '#e1c83cff' },
      tristeza: { emoji: 'ğŸ˜¢', color: '#3e54aeff' },
      enojo: { emoji: 'ğŸ˜ ', color: '#ee2c22ff' },
      calma: { emoji: 'ğŸ˜Œ', color: '#4ee249ff' },
      miedo: { emoji: 'ğŸ˜¨', color: '#943ad8ff' },
      nerviosismo: { emoji: 'ğŸ˜°', color: '#f06e3eff' },
      desmotivacion: { emoji: 'ğŸ˜”', color: '#6b698c' },
      motivacion: { emoji: 'ğŸ¤©', color: '#38d5c6ff' },
      inseguridad: { emoji: 'ğŸ˜•', color: '#c434a0' }
    };

    // ==================== CARGAR DATOS DEL PERFIL ====================
    function cargarPerfil() {
      try {
        // Obtener sesiÃ³n actual
        const sesionActual = localStorage.getItem('emotiquest_sesion_actual');
        
        if (!sesionActual) {
          console.warn('No hay sesiÃ³n activa');
          mostrarError();
          return;
        }

        const sesion = JSON.parse(sesionActual);
        
        // Actualizar datos bÃ¡sicos
        document.getElementById('perfilNombre').textContent = sesion.nombre || 'Usuario';
        document.getElementById('perfilEdad').textContent = sesion.edad ? `${sesion.edad} aÃ±os` : '--';
        document.getElementById('perfilGenero').textContent = capitalizarPrimeraLetra(sesion.genero) || '--';
        document.getElementById('perfilGrado').textContent = sesion.grado || '--';
        document.getElementById('perfilId').textContent = sesion.id || 'Sin ID';

        // Actualizar badge segÃºn grado
        const badgeTexto = document.getElementById('badgeTexto');
        if (sesion.grado) {
          badgeTexto.textContent = sesion.grado;
        }

        // Actualizar avatar
        actualizarAvatar(sesion);

        // Cargar estadÃ­sticas
        cargarEstadisticas(sesion);

        console.log('âœ… Perfil cargado correctamente');
      } catch (error) {
        console.error('âŒ Error al cargar perfil:', error);
        mostrarError();
      }
    }

    // ==================== ACTUALIZAR AVATAR ====================
    function actualizarAvatar(sesion) {
      const avatarEmoji = document.getElementById('avatarEmoji');
      const perfilAvatar = document.getElementById('perfilAvatar');
      
      // Determinar emoji segÃºn gÃ©nero
      let emoji = 'ğŸ˜Š';
      if (sesion.genero === 'masculino') {
        emoji = 'ğŸ‘¦';
      } else if (sesion.genero === 'femenino') {
        emoji = 'ğŸ‘§';
      } else {
        emoji = 'ğŸ§‘';
      }

      // Si hay avatar personalizado, usar ese emoji
      if (sesion.avatar && sesion.avatar.emoji) {
        emoji = sesion.avatar.emoji;
      }

      avatarEmoji.textContent = emoji;

      // Color de fondo segÃºn gÃ©nero
      if (sesion.genero === 'masculino') {
        perfilAvatar.style.background = 'linear-gradient(135deg, #4A90E2, #357ABD)';
      } else if (sesion.genero === 'femenino') {
        perfilAvatar.style.background = 'linear-gradient(135deg, #E91E63, #C2185B)';
      }
    }

    // ==================== CARGAR ESTADÃSTICAS ====================
    function cargarEstadisticas(sesion) {
      try {
        // Obtener historial de sesiones
        const historialJSON = localStorage.getItem('emotiquest_sesiones');
        const historial = historialJSON ? JSON.parse(historialJSON) : [];

        // Filtrar sesiones del usuario actual por ID
        const sesionesUsuario = historial.filter(s => s.id === sesion.id);

        // Total de sesiones completadas
        document.getElementById('statSesiones').textContent = sesionesUsuario.length;

        // Total de respuestas
        let totalRespuestas = 0;
        let conteoEmociones = {};

        sesionesUsuario.forEach(s => {
          if (s.respuestas && Array.isArray(s.respuestas)) {
            totalRespuestas += s.respuestas.length;
            
            // Contar emociones
            s.respuestas.forEach(respuesta => {
              const emocion = respuesta.emocion;
              if (emocion) {
                conteoEmociones[emocion] = (conteoEmociones[emocion] || 0) + 1;
              }
            });
          }
        });

        document.getElementById('statRespuestas').textContent = totalRespuestas;

        // EmociÃ³n mÃ¡s frecuente
        let emocionFrecuente = 'ğŸ˜Š';
        let maxConteo = 0;

        for (const [emocion, conteo] of Object.entries(conteoEmociones)) {
          if (conteo > maxConteo) {
            maxConteo = conteo;
            emocionFrecuente = obtenerEmojiEmocion(emocion);
          }
        }

        document.getElementById('statEmocion').textContent = emocionFrecuente;

      } catch (error) {
        console.error('Error al cargar estadÃ­sticas:', error);
        // Valores por defecto en caso de error
        document.getElementById('statSesiones').textContent = '0';
        document.getElementById('statRespuestas').textContent = '0';
        document.getElementById('statEmocion').textContent = 'ğŸ˜Š';
      }
    }

    // ==================== OBTENER EMOJI DE EMOCIÃ“N ====================
    function obtenerEmojiEmocion(emocion) {
      const emojis = {
        alegria: 'ğŸ˜Š',
        tristeza: 'ğŸ˜¢',
        enojo: 'ğŸ˜ ',
        calma: 'ğŸ˜Œ',
        miedo: 'ğŸ˜¨',
        nerviosismo: 'ğŸ˜°',
        desmotivacion: 'ğŸ˜”',
        motivacion: 'ğŸ¤©',
        inseguridad: 'ğŸ˜•'
      };
      return emojis[emocion] || 'ğŸ˜Š';
    }

    // ==================== CAPITALIZAR PRIMERA LETRA ====================
    function capitalizarPrimeraLetra(texto) {
      if (!texto) return '';
      return texto.charAt(0).toUpperCase() + texto.slice(1).toLowerCase();
    }

    // ==================== MOSTRAR ERROR ====================
    function mostrarError() {
      document.getElementById('perfilNombre').textContent = 'Error al cargar perfil';
      alert('No se pudo cargar el perfil. Vuelve al inicio e inicia sesiÃ³n de nuevo.');
    }

    // ==================== VOLVER ATRÃS ====================
    function volverAtras() {
      // Detectar desde dÃ³nde vino el usuario
      if (document.referrer) {
        window.history.back();
      } else {
        // Si no hay referrer, ir a inicio
        window.location.href = './index.html';
      }
    }

    // ==================== INICIALIZAR ====================
    document.addEventListener('DOMContentLoaded', () => {
      console.log('ğŸ¨ PÃ¡gina de perfil iniciada');
      cargarPerfil();
    });
  </script>

</body>
</html>